<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MovieParadise</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/css/jquery.dataTables.min.css"
        integrity="sha512-1k7mWiTNoyx2XtmI96o+hdjP8nn0f3Z2N4oF/9ZZRgijyV4omsKOXEnqL1gKQNPy2MTSP9rIEWGcH/CInulptA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100..900&family=Noto+Serif+TC&display=swap"
        rel="stylesheet">

</head>
<style>
    body {
        background-image: url(./img/background_edit.jpg);
        background-repeat: no-repeat;
        background-size: cover;
        backdrop-filter: blur(10px);
    }

    #myBtn {
        text-decoration: none;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3vh;
        font-weight: bold;
        width: 18vh;
        height: 8vh;
        border-radius: 15px 0 0 15px;
        position: sticky;
        top: 80%;
        float: right;
        background-image: url(./img/ticket.png);
        background-size: contain;
        background-repeat: no-repeat;
        background-position-x: right;
    }
    #myBtn:hover{
        background-image: url(./img/ticket-hover.png);
    }

    header {
        height: 50vh;
        background-image: url(./img/cover_edit.jpg);
        background-position: center;
    }

    .title {
        font-family: "Noto Sans TC", sans-serif;
        font-optical-sizing: auto;
        font-weight: bold;
        font-style: normal;
    }


    .modal-dialog {
        max-width: 80%;
    }

    .popular_content {
        height: 40vh;
        /* 设置容器的高度，适当调整以满足你的需求 */
        overflow-x: auto;
        /* 允许水平滚动 */
        display: flex;
        gap: 10px;
        /* 可以根据需要调整图片之间的间距 */
    }

    .popular-list {
        min-width: 18%;
        /* 设置每个 .popular-list 的最小宽度 */
        flex-shrink: 0;
        /* 防止缩小，以保持固定宽度 */
        height: 100%;
        /* 使每个 .popular-list 占据容器的完整高度 */
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
    }

    /* 隐藏浏览器默认的滚动条样式 */
    ::-webkit-scrollbar {
        width: 10px;
        /* 设置滚动条的宽度 */
    }

    /* 定义滚动槽的颜色 */
    ::-webkit-scrollbar-track {
        background-color: rgb(255, 255, 255, 0);
        /* 设置滚动槽的颜色 */
    }

    /* 定义滚动条滑块的样式 */
    ::-webkit-scrollbar-thumb {
        background-color: rgb(255, 255, 255, .2);
        /* 设置滑块的颜色 */
        border-radius: 5px;
        /* 设置滑块的圆角 */
    }

    /* 当滑块被悬停时的样式 */
    ::-webkit-scrollbar-thumb:hover {
        background-color: #ffffff;
        /* 设置悬停时的颜色 */
        background-color: rgb(77, 77, 77);
    }

    .movie-list {
        width: 23%;
        height: 20vh;
        background-color: rgb(255, 255, 255, .5);
        border-radius: 10px;
        margin-bottom: 2%;
        overflow: hidden;
        display: flex;
    }

    .movie-list img {
        height: 100%;
    }

    .modal-content {
        width: 50%;
        margin: auto;
    }

    .modal-dialog-scrollable {
        margin: auto;
        margin-top: 100%;
    }

    .searchResult {
        margin: auto;
        margin-top: 50%;
    }

    @media(max-width:640px) {
        .popular_content {
            height: 20vh;
            /* 设置容器的高度，适当调整以满足你的需求 */
            overflow-x: auto;
            /* 允许水平滚动 */
            display: flex;
            gap: 10px;
            /* 可以根据需要调整图片之间的间距 */
        }

        .movie-list {
            width: auto;
        }

        .movie-list img {
            height: 100%;
        }

        h1 {
            font-size: 24px;
        }

        .modal-content {
            width: 100%;
            margin: auto;
        }

        .modal-dialog-scrollable {
            margin: auto;
            margin-top: 250%;
        }

        .searchResult {
            margin: auto;
            margin-top: 150%;
        }
    }
</style>

<body>
    <a href="https://www.ezding.com.tw/" target="_blank"><div id="myBtn"></div></a>

    <div class="container">

        <header>
            <div class="title col-fluid" style="color: white;">
                <h1><br><br><br>&nbsp&nbsp&nbsp&nbsp&nbsp透過電影，發現我們還未體驗的世界...</h1>
            </div>
        </header>

        <main>
            <section class="popular my-5">
                <h3 style="color: white;">
                    <i class="fa-solid fa-fire-flame-curved"></i></i>&nbsp近期熱映
                </h3>
                <div
                    style="width: 500px;height: 5px;background: linear-gradient(to right, rgb(51, 153, 255) , rgb(43, 200, 147),rgb(43, 200, 147,0)80%)">
                </div>
                <div class="popular_content mt-3">
                </div>



            </section>

            <section class="search_bar">
                <h3 style="color: white;">
                    <i class="fa-solid fa-magnifying-glass"></i>&nbsp尋找電影
                </h3>
                <div
                    style="width: 500px;height: 5px;background: linear-gradient(to right, rgb(51, 153, 255) , rgb(43, 200, 147),rgb(43, 200, 147,0)80%)">
                </div>
                <form class="my-3">
                    <label style="color: white;">電影名稱 : </label>
                    <input type="search" name="movieName" id="movieName">
                    <button type="button" class="searchBtn" id="searchBtn">搜尋</button>
                </form>

                <div class="results" id="results" style='display:flex;flex-wrap: wrap;height: 500px;overflow: auto;'>
                    <span style="font-size: 40px;color:white">請在搜尋欄輸入電影名稱</span>
                </div>
            </section>

            <section>
                <h3 style="color: white;margin-top: 100px;">
                    <i class="fa-solid fa-tape"></i>&nbsp電影簡介
                </h3>
                <div
                    style="width: 500px;height: 5px;background: linear-gradient(to right, rgb(51, 153, 255) , rgb(43, 200, 147),rgb(43, 200, 147,0)80%)">
                </div>
                <div id="intro" class="mt-5"
                    style="display: flex;flex-wrap: wrap;gap: 2%;height: 500px;overflow: auto;">

                </div>
            </section>
        </main>



        <footer style="margin-top: 10vh;">
            <div
                style="background: #060c36;height: 15vh;color: white;display: flex;justify-content: space-between;padding: 20px;align-items: center;">
                <span>All informations from
                    <a href="https://www.themoviedb.org/" target="_blank"
                        style="text-decoration: none;color: rgb(43, 200, 147);font-weight: bold;">TMDB</a>
                    | Designed by <span style="color: rgb(255, 183, 0);font-weight: bold;">Rudy_chen</span>
                </span>
                <a href="https://www.instagram.com/rudy_chenboru/" target="_blank"><i class="fa-brands fa-instagram"
                        style="color: #ffffff;float: right;font-size: 40px;"></i></a>
            </div>
            <div
                style="height: 5px;background: linear-gradient(to right, rgb(51, 153, 255) , rgb(43, 200, 147),rgb(43, 200, 147))">
            </div>
        </footer>



    </div>





    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script src="./api_key.js"></script>

    <script>
        $(document).ready(function () {


            $.ajax({
                type: "get",
                url: trendingMovie,
                dataType: 'json',
                success: function (data) {
                    // console.log('data', data)
                    let movies = data.results
                    // console.log('movies', movies)


                    $.each(movies, function (key, value) {
                        // console.log('key', key)
                        // console.log('value', value)
                        let moviesName = value.title
                        let moviesPoster = value.poster_path
                        let movieId = "movie" + value.id
                        let movieVideo = value.id
                        let title = value.title
                        let overView = value.overview
                        let cardContent = overView.substring(0, 30)
                        let releaseDate = value.release_date
                        // console.log('moviesName', moviesName)

                        if (overView != '') {

                            let content = `
                            <div class="popular-list" style="width: 18%;background-image: url(https://image.tmdb.org/t/p/w500/${moviesPoster});
                            background-repeat: no-repeat;background-size: contain;"></div>                
                            `

                            $('.popular_content').append(content)
                        }

                    })
                }
            })

            $.ajax({
                type: "get",
                url: popularMovie,
                dataType: 'json',
                success: function (data) {
                    // console.log('data', data)
                    let movies = data.results
                    // console.log('movies', movies)


                    $.each(movies, function (key, value) {
                        // console.log('key', key)
                        // console.log('value', value)
                        let moviesName = value.title
                        let moviesPoster = value.poster_path
                        let movieId = "movie" + value.id
                        let movieVideo = value.id
                        let title = value.title
                        let overView = value.overview
                        let cardContent = overView.substring(0, 30)
                        let releaseDate = value.release_date
                        // console.log('moviesName', moviesName)

                        if (overView != '') {
                            let intro = `<div class="movie-list">
                                <button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#${movieId}"><img src="https://image.tmdb.org/t/p/w154/${moviesPoster}"></button>
                                <div style='margin-right:10px;margin-top:5px;font-size:15px;color:white'><span><${title}></span><br>${cardContent}...</div>
                                </div>
    
                                <div class="modal fade" id="${movieId}" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
                                        aria-labelledby="staticBackdropLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-scrollable">
                                            <div class="modal-content" style='background-color:#ccc'>
                                                <div class="modal-header" style='background-color:rgb(77, 77, 77)'>
                                                    <h5 class="modal-title" id="staticBackdropLabel" style='font-weight:bold;color:white'>
                                                        <i class="fa-solid fa-video" style="color: #FFD43B;"></i>&nbsp ${title}
                                                    </h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <div class='mb-3' id='modal-body-content'>
                                                    <div>                                                       
                                                        <p>
                                                            <i class="fa-solid fa-circle-play fa-flip-vertical" style="color: #24457b;"></i>
                                                            ${overView}
                                                        </p>
                                                    </div>
                                                    <div>
                                                        <p>
                                                            <i class="fa-solid fa-calendar-week" style="color: #24457b;"></i>
                                                            上映時間 : ${releaseDate}
                                                        </p>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>        
                                `
                            $("#intro").append(intro)


                            $.ajax({
                                type: "get",
                                url: `https://api.themoviedb.org/3/movie/${movieVideo}/videos?language=zh-TW${apiKey}`,
                                dataType: 'json',
                                success: function (videoData) {
                                    // console.log('videoData', videoData);

                                    if (videoData.results && videoData.results.length > 0) {
                                        let videos = videoData.results;
                                        $.each(videos, function (videoKey, videoValue) {
                                            let moviesKey = videoValue.key;
                                            // console.log('moviesKey', moviesKey)

                                            let videoContent = `
                                                  <iframe width="450" height="315" src="https://www.youtube.com/embed/${moviesKey}?si=k8ZO6cumfCJ80mJv" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                                              `;


                                            $(`#${movieId} #modal-body-content`).append(videoContent);
                                        });
                                    } else {
                                        $.ajax({
                                            type: "get",
                                            url: `https://api.themoviedb.org/3/movie/${movieId}/videos?${apiKey}`,
                                            dataType: 'json',
                                            success: function (videoData) {
                                                if (videoData.results && videoData.results.length > 0) {
                                                    let videos = videoData.results;

                                                    $.each(videos, function (videoKey, videoValue) {
                                                        let moviesKey = videoValue.key;
                                                        // console.log('moviesKey', moviesKey)

                                                        let videoContent = `
                                                             <iframe width="450" height="315" src="https://www.youtube.com/embed/${moviesKey}?si=k8ZO6cumfCJ80mJv" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                                                         `;


                                                        $(`#modal-body-content`).append(videoContent);
                                                    });
                                                }
                                            }
                                        })
                                    }
                                }
                            });

                        }

                    })
                }
            })








            let searchBtn = $('#searchBtn');
            let movieName = $('#movieName');


            // 按下Enter鍵也能搜尋
            movieName.keydown(function (event) {
                if (event.key === "Enter") {
                    // 清空搜尋結果
                    $('#results').html('');
                    // 按下Enter鍵時不會自動將表單傳送出去，會停留在結果
                    event.preventDefault();
                    searchMovie();
                }
            });

            searchBtn.click(function () {
                $('#results').html('');
                searchMovie();
            });



            function searchMovie() {
                let getMovieName = movieName.val();
                // console.log('getMovieName', getMovieName)

                let url = `https://api.themoviedb.org/3/search/movie?query=${getMovieName}&language=zh-TW${apiKey}`
                $.ajax({
                    type: "get",
                    url: url,
                    dataType: 'json',
                    success: function (data) {
                        // console.log('data', data)
                        let movieResults = data.results

                        $.each(movieResults, function (key, value) {
                            // console.log('value', value)
                            let moviesId = value.id
                            let img = value.poster_path
                            let title = value.title
                            let overView = value.overview
                            let releaseDate = value.release_date
                            let moviesKey;

                            if (img != null) {

                                // 為了讓bootstrap的彈跳視窗帶入個別電影的id
                                let movieId = 'movie' + value.id
                                let content = `
                                <div>
                                    <button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#${movieId}"><img src="https://image.tmdb.org/t/p/w154/${img}" alt="${title}"></button>
                                    
                                   
                                    <div class="modal fade" id="${movieId}" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
                                        aria-labelledby="staticBackdropLabel" aria-hidden="true">
                                        <div class="searchResult modal-dialog modal-dialog-scrollable">
                                            <div class="modal-content" style="background-color:#ccc">
                                                <div class="modal-header" style='background-color:rgb(77, 77, 77)'>
                                                    <h5 class="modal-title" id="staticBackdropLabel" style='font-weight:bold;color:white'>
                                                        <i class="fa-solid fa-video" style="color: #FFD43B;"></i>&nbsp ${title}
                                                    </h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <div class='mb-3' id='modal-body-content'>
                                                        <div>                                                       
                                                        <p>
                                                            <i class="fa-solid fa-circle-play fa-flip-vertical" style="color: #24457b;"></i>
                                                            ${overView}
                                                        </p>
                                                    </div>
                                                    <div>
                                                        <p>
                                                            <i class="fa-solid fa-calendar-week" style="color: #24457b;"></i>
                                                            上映時間 : ${releaseDate}
                                                        </p>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                `

                                $('#results').append(content)


                                $.ajax({
                                    type: "get",
                                    url: `https://api.themoviedb.org/3/movie/${moviesId}/videos?language=zh-TW${apiKey}`,
                                    dataType: 'json',
                                    success: function (videoData) {
                                        // console.log('videoData', videoData);

                                        if (videoData.results && videoData.results.length > 0) {
                                            let videos = videoData.results;
                                            $.each(videos, function (videoKey, videoValue) {
                                                let moviesKey = videoValue.key;
                                                // console.log('moviesKey', moviesKey)

                                                let videoContent = `
                                                      <iframe width="450" height="315" src="https://www.youtube.com/embed/${moviesKey}?si=k8ZO6cumfCJ80mJv" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                                                  `;


                                                $(`#${movieId} #modal-body-content`).append(videoContent);
                                            });
                                        } else {
                                            $.ajax({
                                                type: "get",
                                                url: `https://api.themoviedb.org/3/movie/${moviesId}/videos?${apiKey}`,
                                                dataType: 'json',
                                                success: function (videoData) {
                                                    if (videoData.results && videoData.results.length > 0) {
                                                        let videos = videoData.results;

                                                        $.each(videos, function (videoKey, videoValue) {
                                                            let moviesKey = videoValue.key;
                                                            // console.log('moviesKey', moviesKey)

                                                            let videoContent = `
                                                                 <iframe width="450" height="315" src="https://www.youtube.com/embed/${moviesKey}?si=k8ZO6cumfCJ80mJv" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                                                             `;


                                                            $(`#${movieId} #modal-body-content`).append(videoContent);
                                                        });
                                                    }
                                                }
                                            })
                                        }
                                    }
                                });
                            }



                        })



                    }
                })
            }







        })
    </script>
</body>

</html>